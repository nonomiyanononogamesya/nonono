<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>野々宮ののの</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="icon" href="assets/images/youxishe.png" sizes="32x32">
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">
		<div class="language">
			<img src="assets/icons/language.svg">
			<p>中</p>
		</div>

		<!-- Header -->
		<header id="header">
			<div class="logo">
				<img id="music" src="assets/icons/audiotrack-24px.svg">
			</div>
			<div class="content">
				<div class="inner">
					<audio id="bgm"></audio>
					<div class="lrc"></div>
				</div>
			</div>
			<nav>
				<ul>
					<li><a id="nobutton" href="./nobutton/">の按钮</a></li>
					<li><a id="nomusic" href="./nomusic/">の音乐</a></li>
				</ul>
			</nav>
		</header>

		<!-- Footer -->
		<footer id="footer">
			<p class="copyright">
				By <a id="footer_name" href="https://space.bilibili.com/582466811" target="blank">
					野野宫ののの游戏社
				</a>
			</p>
		</footer>

	</div>

	<!-- BG -->
	<div id="bg-unready"></div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script type="text/javascript">    $(function () {
			$(document).ready(function () {
				$("#bgm").attr("autoplay", "autoplay").attr("src", "assets/audio/奏.mp3");
				let audio = document.querySelector('audio');
				if (audio.paused) {
					$(this).attr("src", "assets/icons/audiotrack-24px.svg");
					audio.play();
				} else {
					$(this).attr("src", "assets/icons/music_off-24px.svg");
					audio.pause();
				}
			})
			window.onload = function () {
				$("#bg-unready").attr("id", "bg");
				var isMobile = /Android|webOS|iPhone|iPad|BlackBerry/i.test(navigator.userAgent)
				if (isMobile) {
					// 当前网页在手机端打开
					$("#bg").attr("id", "bg_mobile");
				} else {
					// 当前网页在PC端打开
				}
			}

			$(".language").click(function(){
				if($(".language").children("p").text() == "あ"){
					$(".language").children("p").text("中");
					$("#nobutton").text("の按钮");
					$("#nomusic").text("の音乐");
					$("#footer_name").text("野野宫ののの游戏社");
				}else{
					$(".language").children("p").text("あ");
					$("#nobutton").text("のボタン");
					$("#nomusic").text("の音楽");
					$("#footer_name").text("野々宮のののゲーム社");
				}
			})

			$("#music").click(function () {
				let audio = document.querySelector('audio');
				if (audio.paused) {
					$(this).attr("src", "assets/icons/audiotrack-24px.svg");
					audio.play();
				} else {
					$(this).attr("src", "assets/icons/music_off-24px.svg");
					audio.pause();
				}
			})

			// 歌词
			function parseLyric(text) {
				//按行分割歌词            
				let lyricArr = text.split('\n');
				let result = [];
				//新建一个数组存放最后结果      
				//遍历分割后的歌词数组，将格式化后的时间节点，歌词填充到result数组           
				for (i = 0; i < lyricArr.length; i++) {
					let playTimeArr = lyricArr[i].match(/\[\d{2}:\d{2}((\.|\:)\d{2})\]/g);
					//正则匹配播放时间               
					let lineLyric = "";
					if (lyricArr[i].split(playTimeArr).length > 0) {
						lineLyric = lyricArr[i].split(playTimeArr);
					}
					if (playTimeArr != null) {
						for (let j = 0; j < playTimeArr.length; j++) {
							let time = playTimeArr[j].substring(1, playTimeArr[j].indexOf("]")).split(":");                        //数组填充   
							result.push({ time: (parseInt(time[0]) * 60 + parseFloat(time[1])).toFixed(4), content: String(lineLyric).substr(1) });
						}
					}
				}
				return result;
			}
			// 这里请按照格式放入相应歌词--开始
			// 格式可能看着很复杂,其实是根据lrc歌词文件换句前加入\n 换行符,然后删除多余空行.即可!        
			let text = "[00:00.00]奏 かなで\n[00:42.03]改札の前つなぐ手と手\n[00:47.99]いつものざわめき、新しい風\n[00:54.80]明るく見送るはずだったのに\n[01:00.87]うまく笑えずに君を見ていた\n[01:08.95]君が大人になってくその季節が\n[01:15.22]悲しい歌で溢れないように\n[01:21.56]最後に何か君に伝えたくて\n[01:27.54]「さよなら」に代わる言葉を僕は探してた\n[01:41.21]君の手を引くその役目が僕の使命だなんて\n[01:51.02]そう思ってた\n[01:56.14]だけど今わかったんだ　僕らならもう\n[02:02.14]重ねた日々がほら、導いてくれる\n[02:08.49]君が大人になってくその時間が\n[02:14.43]降り積もる間に僕も変わってく\n[02:20.81]たとえばそこにこんな歌があれば\n[02:26.83]ふたりはいつもどんな時もつながっていける\n[03:05.26]突然ふいに鳴り響くベルの音\n[03:11.97]焦る僕　解ける手　離れてく君\n[03:18.38]夢中で呼び止めて　抱き締めたんだ\n[03:24.88]君がどこに行ったって僕の聲で守るよ\n[03:35.70]君が僕の前に現れた日から\n[03:42.44]何もかもが違くみえたんだ\n[03:48.85]朝も光も涙も、歌う聲も\n[03:54.93]君が輝きをくれたんだ\n[04:01.25]抑えきれない思いをこの聲に乗せて\n[04:08.03]遠く君の街へ屆けよう\n[04:14.51]たとえばそれがこんな歌だったら\n[04:20.63]ぼくらは何処にいたとしてもつながっていける\n"
			// 这里请按照格式放入相应歌词--结束        
			let audio = document.querySelector('audio');
			let result = parseLyric(text); //执行lyc解析        // 把生成的数据显示到界面上去        
			let $ul = $("<ul></ul>");
			for (let i = 0; i < result.length; i++) {
				let $li = $("<li></li>").text(result[i].content);
				$ul.append($li);
			}
			$(".lrc").append($ul);
			let lineNo = 0;
			// 当前行歌词        
			let preLine = 1; // 当播放6行后开始滚动歌词
			let lineHeight = -30; // 每次滚动的距离        // 滚动播放 歌词高亮  增加类名active  
			function highLight() {
				let $li = $("li"); $li.eq(lineNo).addClass("active").siblings().removeClass("active");
				if (lineNo > preLine) {
					$ul.stop(true, true).animate({ top: (lineNo - preLine) * lineHeight });
				}
			}
			highLight();
			// 播放的时候不断渲染   
			audio.addEventListener("timeupdate", function () {
				if (lineNo == result.length) return; if ($("li").eq(0).hasClass("active")) {
					$("ul").css("top", "0");
				}
				lineNo = getLineNo(audio.currentTime); highLight();
				lineNo++;
			});
			// 当快进或者倒退的时候，找到最近的后面那个
			function getLineNo(currentTime) {
				if (currentTime >= parseFloat(result[lineNo].time)) {                // 快进                
					for (let i = result.length - 1; i >= lineNo; i--) {
						if (currentTime >= parseFloat(result[i].time)) {
							return i;
						}
					}
				} else {
					// 后退                
					for (let i = 0; i <= lineNo; i++) {
						if (currentTime <= parseFloat(result[i].time)) {
							return i - 1;
						}
					}
				}
			}
			//播放结束自动回到开头 
			audio.addEventListener("ended", function () {
				lineNo = 0;
				highLight();
				audio.play();
				$("ul").css("top", "0");
			});
		});    
	</script>
</body>

</html>